<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Operativa - Rischio Maremoto Costa Jonica</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        :root {
            --primary-color: #0d47a1; /* Blu Scuro Intenso */
            --secondary-color: #f5f5f5; /* Grigio Sfondo */
            --dark-color: #212121; /* Nero Testo */
            --light-color: #ffffff;
            --danger-color: #c62828;
            --warning-color: #ef6c00;
            --info-color: #0277bd;
            --border-radius: 8px;
            --shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        * { box-sizing: border-box; }
        body {
            font-family: 'Roboto', sans-serif;
            line-height: 1.6;
            margin: 0;
            background-color: var(--secondary-color);
            color: var(--dark-color);
        }
        .container-fluid {
            max-width: 95%;
            margin: auto;
        }
        .main-header {
            background: var(--light-color);
            padding: 0.5rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #e0e0e0;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        .main-header .logos img {
            height: 50px;
            margin: 0 10px;
        }
        .main-header .title h1 {
            margin: 0;
            color: var(--primary-color);
            font-size: 1.8rem;
        }
        .operator-selector {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .operator-selector label {
            font-weight: 700;
            color: var(--primary-color);
        }
        .operator-selector select {
            padding: 8px 12px;
            border-radius: var(--border-radius);
            border: 2px solid var(--primary-color);
            font-size: 1rem;
            font-weight: 500;
        }
        .dashboard-container {
            display: flex;
            gap: 20px;
            padding: 20px 0;
        }
        .main-content {
            flex: 3; /* 70% width */
        }
        .sidebar {
            flex: 1; /* 30% width */
            position: sticky;
            top: 85px; /* height of header + padding */
            align-self: flex-start;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .tabs {
            display: flex;
            background: var(--light-color);
            flex-wrap: wrap;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            overflow: hidden;
        }
        .tab-link {
            padding: 15px;
            cursor: pointer;
            border: none;
            background: transparent;
            font-size: 1rem;
            font-weight: 700;
            color: var(--dark-color);
            transition: all 0.3s ease;
            flex-grow: 1;
            text-align: center;
            border-bottom: 4px solid transparent;
        }
        .tab-link.active, .tab-link:hover {
            color: var(--primary-color);
            background-color: #e3f2fd;
            border-bottom-color: var(--primary-color);
        }
        .tab-content {
            display: none;
            margin-top: 20px;
        }
        .tab-content.active {
            display: block;
        }
        .alert-section {
            border-radius: var(--border-radius);
            padding: 20px;
            margin-top: 20px;
            background: var(--light-color);
            border: 1px solid #ddd;
            transition: all 0.3s ease;
            box-shadow: var(--shadow);
        }
        .alert-orange { border-left: 5px solid var(--warning-color); }
        .alert-red { border-left: 5px solid var(--danger-color); }

        .section-highlight {
            box-shadow: 0 0 0 3px var(--info-color), var(--shadow);
            border-color: var(--info-color);
        }
        h2, h3 { color: var(--primary-color); }
        h2 { border-bottom: 2px solid #e0e0e0; padding-bottom: 10px; margin-top: 0; }
        h4.alert-title-orange { color: var(--warning-color); font-size: 1.5rem; }
        h4.alert-title-red { color: var(--danger-color); font-size: 1.5rem; }
        .card {
            background: var(--light-color);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
        }
        .card h3 { margin-top: 0; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { padding: 12px 15px; border: 1px solid #e0e0e0; text-align: left; }
        th { background-color: #eceff1; font-weight: 700; }
        td i { margin-right: 8px; color: var(--primary-color); width: 20px; text-align: center; }
        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        .note, .primary-task-info {
            background-color: #e3f2fd;
            border-left: 6px solid var(--info-color);
            padding: 15px;
            margin: 20px 0;
            border-radius: var(--border-radius);
        }
        .primary-task-info { display: none; }
        .map-container {
            width: 100%;
            height: 300px;
            border-radius: var(--border-radius);
            overflow: hidden;
            border: 2px solid var(--primary-color);
        }
        .map-container iframe { width: 100%; height: 100%; border: 0; }
        .key-points ul { list-style-type: none; padding: 0; }
        .key-points li { background: #e8eaf6; margin-bottom: 8px; padding: 10px; border-radius: 4px; }
        .disclaimer {
            font-size: 0.9em;
            color: var(--danger-color);
            font-weight: bold;
            text-align: center;
            padding-top: 10px;
        }
        footer { text-align: center; padding: 20px; margin-top: 20px; background-color: var(--dark-color); color: var(--light-color); }
    </style>
</head>
<body>

    <header class="main-header">
        <div class="logos">
            <img src="LOGO.png" alt="Logo Istituzionale">
            <img src="icopc.gif" alt="Logo Protezione Civile">
        </div>
        <div class="title">
            <h1>Dashboard Operativa Maremoto</h1>
        </div>
        <div class="operator-selector">
            <label for="operator-role"><i class="fas fa-user-shield"></i> Ruolo Operativo:</label>
            <select id="operator-role" onchange="changeOperatorView(this.value)">
                <option value="tutti">Tutti / Prefettura</option>
                <option value="forze_ordine">Forze dell'Ordine</option>
                <option value="sindaco">Sindaco / Ufficio Tecnico</option>
                <option value="volontariato">Volontariato</option>
            </select>
        </div>
    </header>

    <div class="container-fluid">
        <div class="dashboard-container">
            <main class="main-content">
                <nav class="tabs">
                    <button class="tab-link active" data-tab-target="Generale" data-coords="40.25,16.7" data-zoom="10" data-comune="Costa Jonica" data-coc=""><i class="fas fa-info-circle"></i> Generali</button>
                    <button class="tab-link" data-tab-target="NS-Rotondella" data-coords="40.1258,16.5685" data-zoom="14" data-comune="Nova Siri - Rotondella" data-coc="P.zza Papa Giovanni XXIII">Nova Siri - Rotondella</button>
                    <button class="tab-link" data-tab-target="Policoro" data-coords="40.2032,16.6692" data-zoom="14" data-comune="Policoro" data-coc="Piazza A. Moro">Policoro</button>
                    <button class="tab-link" data-tab-target="Scanzano" data-coords="40.2512,16.6936" data-zoom="14" data-comune="Scanzano Jonico" data-coc="P.zza A. Gramsci">Scanzano J.</button>
                    <button class="tab-link" data-tab-target="Pisticci" data-coords="40.3185,16.7538" data-zoom="13" data-comune="Pisticci" data-coc="Non specificato (Area Marconia)">Pisticci</button>
                    <button class="tab-link" data-tab-target="Bernalda" data-coords="40.3736,16.8134" data-zoom="14" data-comune="Bernalda" data-coc="P.zza P.Giovanni XXIII">Bernalda</button>
                </nav>
                
                <div class="primary-task-info" id="task-info-box">
                     <p><i class="fas fa-bullseye"></i><strong>Compiti Primari:</strong> <span id="task-info-text"></span></p>
                </div>

                <div id="Generale" class="tab-content active"><div class="card"><h2><i class="fas fa-file-alt"></i> Procedure Generali...</h2></div></div>
                <div id="NS-Rotondella" class="tab-content"><div class="card"><h2><i class="fa-solid fa-people-group"></i> Modello Intercomunale: Nova Siri e Rotondella...</h2></div></div>
                <div id="Policoro" class="tab-content"><div class="card"><h2><i class="fa-solid fa-landmark"></i> Modello Comunale: Policoro...</h2></div></div>
                <div id="Scanzano" class="tab-content"><div class="card"><h2><i class="fa-solid fa-wheat-awn"></i> Modello Comunale: Scanzano Jonico...</h2></div></div>
                <div id="Pisticci" class="tab-content"><div class="card"><h2><i class="fa-solid fa-industry"></i> Modello Comunale: Pisticci...</h2></div></div>
                <div id="Bernalda" class="tab-content"><div class="card"><h2><i class="fa-solid fa-gopuram"></i> Modello Comunale: Bernalda (Metaponto)...</h2></div></div>

            </main>
            <aside class="sidebar">
                <div class="card">
                    <h3><i class="fas fa-phone-alt"></i> Contatti di Emergenza</h3>
                    <table>
                        <caption class="disclaimer"><i class="fas fa-exclamation-triangle"></i> ATTENZIONE: I numeri locali sono fittizi.</caption>
                        <thead>
                            <tr><th>Ente</th><th>Numero</th></tr>
                        </thead>
                        <tbody>
                            <tr><td><i class="fas fa-exclamation-triangle"></i>N.U.E.</td><td><strong>112</strong></td></tr>
                            <tr><td><i class="fas fa-fire-extinguisher"></i>Vigili del Fuoco</td><td><strong>115</strong></td></tr>
                            <tr><td><i class="fas fa-heartbeat"></i>Emergenza Sanitaria</td><td><strong>118</strong></td></tr>
                            <tr><td><i class="fas fa-life-ring"></i>Guardia Costiera</td><td><strong>1530</strong></td></tr>
                            <tr><td><i class="fas fa-building"></i>Prefettura MT - S.O.</td><td><strong>0835 12345</strong></td></tr>
                            <tr><td><i class="fas fa-satellite-dish"></i>Prot. Civile REG - S.O.</td><td><strong>0971 654321</strong></td></tr>
                            <tr><td><i class="fas fa-user-shield"></i>Questura MT - S.O.</td><td><strong>0835 54321</strong></td></tr>
                        </tbody>
                    </table>
                </div>
                 <div class="card" id="coc-contacts-card">
                    <h3><i class="fas fa-headset"></i> Reperibilità C.O.C.</h3>
                    <div id="coc-contacts-content">
                        <p>Selezionare un comune per visualizzare i contatti.</p>
                    </div>
                 </div>
                 <div class="card">
                    <h3><i class="fas fa-map-marked-alt"></i> Mappa Operativa</h3>
                    <div class="map-container">
                         <iframe id="operative-map-iframe" src="https://maps.google.com/maps?q=40.25,16.7&t=&z=10&ie=UTF8&iwloc=&output=embed" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
                    </div>
                    <div class="key-points">
                        <h4><i class="fas fa-map-pin"></i> Punti Chiave Comune Selezionato</h4>
                        <ul id="map-key-points">
                           <li>Visione d'insieme della costa.</li>
                        </ul>
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <footer>
        <div class="container-fluid">
            <p>Fonte Dati: Prefettura di Matera - Aggiornamento del "Piano Provinciale di Protezione Civile per il Rischio Maremoto" (Rev. 2, 2023).</p>
            <p>Questo portale è una simulazione a scopo dimostrativo e non sostituisce i documenti ufficiali e le direttive operative.</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const tabsContainer = document.querySelector('.tabs');
            const mapIframe = document.getElementById('operative-map-iframe');
            const keyPointsList = document.getElementById('map-key-points');
            const cocContactsContent = document.getElementById('coc-contacts-content');

            // Funzione per aggiornare la mappa e le info correlate
            function updateDynamicInfo(tab) {
                const coords = tab.dataset.coords;
                const zoom = tab.dataset.zoom;
                const coc = tab.dataset.coc;
                const comune = tab.dataset.comune;

                // 1. Aggiorna la mappa
                if (coords && zoom) {
                    mapIframe.src = `https://maps.google.com/maps?q=${coords}&t=&z=${zoom}&ie=UTF8&iwloc=&output=embed`;
                }

                // 2. Aggiorna i punti chiave
                if (coc) {
                    keyPointsList.innerHTML = `
                        <li><strong><i class="fas fa-building"></i> C.O.C. Location:</strong> ${coc}</li>
                        <li><strong><i class="fas fa-crosshairs"></i> Coordinate Focus:</strong> ${coords}</li>
                    `;
                } else {
                    keyPointsList.innerHTML = '<li>Visione d\'insieme della costa Jonica.</li>';
                }
                
                // 3. Aggiorna i contatti fittizi del C.O.C.
                if (comune && comune !== 'Costa Jonica') {
                    // Genera numeri fittizi basati su un hash semplice del nome del comune per renderli univoci
                    const hash = s => s.split('').reduce((a,b)=>{a=((a<<5)-a)+b.charCodeAt(0);return a&a},0);
                    let baseNum = Math.abs(hash(comune)).toString().substr(0, 6);
                    while(baseNum.length < 6) baseNum += '0';
                    
                    cocContactsContent.innerHTML = `
                        <p><strong>Comune:</strong> ${comune}</p>
                        <table>
                           <tr><td><i class="fas fa-user-tie"></i> Sindaco</td><td>331 ${baseNum.substr(0,3)} ${baseNum.substr(3,3)}</td></tr>
                           <tr><td><i class="fas fa-hard-hat"></i> Resp. Uff. Tecnico</td><td>338 ${baseNum.substr(3,3)} ${baseNum.substr(0,3)}</td></tr>
                        </table>
                    `;
                } else {
                    cocContactsContent.innerHTML = '<p>Selezionare un comune per visualizzare i contatti.</p>';
                }
            }

            // Event listener per la selezione delle schede
            tabsContainer.addEventListener('click', e => {
                const clickedTab = e.target.closest('.tab-link');
                if (!clickedTab) return;

                e.preventDefault();

                document.querySelectorAll('.tab-link').forEach(link => link.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                
                clickedTab.classList.add('active');
                const targetContent = document.getElementById(clickedTab.dataset.tabTarget);
                if(targetContent) targetContent.classList.add('active');
                
                updateDynamicInfo(clickedTab);
            });

            // Stato iniziale
            updateDynamicInfo(document.querySelector('.tab-link.active'));
        });

        // Funzione per la vista operatore
        function changeOperatorView(operator) {
            const taskInfoBox = document.getElementById('task-info-box');
            const taskInfoText = document.getElementById('task-info-text');
            
            document.querySelectorAll('.procedural-section').forEach(el => el.classList.remove('section-highlight'));
            taskInfoBox.style.display = 'none';

            switch(operator) {
                case 'forze_ordine':
                    taskInfoText.innerHTML = "Controllo accessi e viabilità. Evidenziati i <strong>Cancelli</strong> da presidiare.";
                    taskInfoBox.style.display = 'block';
                    document.querySelectorAll('[id*="-cancelli"]').forEach(el => el.classList.add('section-highlight'));
                    break;
                case 'sindaco':
                    taskInfoText.innerHTML = "Coordinamento comunale. Evidenziate le <strong>Aree di Protezione Civile</strong> e la localizzazione del C.O.C.";
                    taskInfoBox.style.display = 'block';
                    document.querySelectorAll('[id*="-aree"]').forEach(el => el.classList.add('section-highlight'));
                    break;
                case 'volontariato':
                    taskInfoText.innerHTML = "Assistenza alla popolazione. Evidenziate le <strong>Aree di Protezione Civile</strong> (Aree Attesa e Ammassamento).";
                    taskInfoBox.style.display = 'block';
                    document.querySelectorAll('[id*="-aree"]').forEach(el => el.classList.add('section-highlight'));
                    break;
                case 'tutti':
                default:
                    break;
            }
        }
    </script>

</body>
</html>
